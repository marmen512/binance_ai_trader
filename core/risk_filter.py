"""
Модуль фільтрації ризикованих торгових сигналів.

Реалізує прості правила для відхилення сигналів в умовах
високого ризику або низької впевненості моделі.
"""


def risk_filter(signal, prob, volatility, min_prob=0.6, max_volatility=0.03):
    """
    Фільтрує торгові сигнали на основі ризик-параметрів.
    
    Логіка фільтрації:
    - Відхиляє сигнали BUY/SELL якщо ймовірність моделі занадто низька
    - Відхиляє сигнали BUY/SELL при занадто високій волатильності
    - Завжди пропускає HOLD сигнали
    
    Параметри:
        signal (str): вхідний сигнал ('BUY', 'SELL', 'HOLD')
        prob (float): ймовірність сигналу від моделі (0-1)
        volatility (float): поточна волатильність ринку
        min_prob (float): мінімальна прийнятна ймовірність для торгівлі (за замовчуванням 0.6)
        max_volatility (float): максимальна прийнятна волатильність (за замовчуванням 0.03 = 3%)
        
    Повертає:
        str: відфільтрований сигнал ('BUY', 'SELL' або 'HOLD')
    """
    # HOLD завжди пропускаємо без змін
    if signal == 'HOLD':
        return signal
    
    # Перевіряємо ймовірність: якщо модель не впевнена, переходимо у HOLD
    if prob < min_prob:
        print(f"Фільтр: низька ймовірність ({prob:.3f} < {min_prob}), сигнал -> HOLD")
        return 'HOLD'
    
    # Перевіряємо волатильність: при високій волатильності не торгуємо
    if volatility > max_volatility:
        print(f"Фільтр: висока волатильність ({volatility:.4f} > {max_volatility}), сигнал -> HOLD")
        return 'HOLD'
    
    # Якщо всі перевірки пройдено, повертаємо оригінальний сигнал
    return signal
