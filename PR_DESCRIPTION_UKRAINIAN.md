# PR: Додано Decision Engine, Feature Engineering та AI Backtest для BTCUSDT 5m

## Опис змін

Цей PR додає повний пайплайн машинного навчання для торгівлі BTCUSDT на 5-хвилинних свічках:

### Нові модулі:

1. **core/feature_builder.py** - Побудова технічних індикаторів з OHLCV даних
2. **training/build_target.py** - Створення мульти-класової цільової змінної (-1, 0, 1)
3. **training/train_model.py** - Загальний пайплайн тренування RandomForest моделі
4. **training/train_btc_5m.py** - BTC-специфічний тренувальний скрипт
5. **core/decision_engine.py** - Механізм генерації торгових сигналів (BUY/SELL/HOLD)
6. **core/risk_filter.py** - Фільтр ризикованих сигналів
7. **scripts/download_btc_5m.py** - Завантаження історичних даних з Binance API
8. **scripts/test_signal.py** - Тестування генерації сигналів
9. **ai_backtest/engine.py** - Движок AI бектестингу з урахуванням комісій та проковзування
10. **ai_backtest/metrics.py** - Обчислення метрик стратегії (winrate, profit factor, тощо)
11. **scripts/run_ai_backtest.py** - Запуск повного бектесту
12. **scripts/plot_equity.py** - Візуалізація кривої капіталу

### Оновлено:

- **requirements.txt** - Додано scikit-learn, joblib, requests, matplotlib

## Як використовувати

### 1. Встановлення залежностей

```bash
pip install -r requirements.txt
```

Необхідні пакети:
- pandas - обробка даних
- numpy - числові обчислення
- scikit-learn - машинне навчання
- joblib - збереження моделей
- requests - завантаження даних з API
- matplotlib - візуалізація

### 2. Завантаження даних

```bash
python scripts/download_btc_5m.py
```

Цей скрипт завантажить історичні дані BTCUSDT 5m за останні 90 днів з Binance API та збереже їх у `data/btcusdt_5m.csv`.

### 3. Тренування моделі

```bash
python training/train_btc_5m.py
```

Цей скрипт:
- Завантажує сирі дані
- Будує технічні ознаки (прибутковість, волатильність, EMA, RSI, тощо)
- Створює цільову змінну (BUY/HOLD/SELL)
- Тренує модель RandomForest
- Зберігає модель у `models/btc_5m_model.pkl`

### 4. Тестування сигналів

```bash
python scripts/test_signal.py
```

Цей скрипт:
- Завантажує дані та модель
- Генерує торговий сигнал на останніх свічках
- Застосовує ризик-фільтр
- Виводить фінальний сигнал та ймовірність

### 5. Запуск бектесту

```bash
python scripts/run_ai_backtest.py
```

Цей скрипт:
- Симулює торгівлю на історичних даних
- Враховує комісії біржі (0.1%) та проковзування (0.05%)
- Обчислює метрики стратегії
- Зберігає результати у `data/equity_curve.csv` та `data/trades.csv`

### 6. Візуалізація результатів

```bash
python scripts/plot_equity.py
```

Створює графік кривої капіталу та просадки, зберігає у `data/equity_plot.png`.

## Технічні деталі

### Ознаки (Features)

Модель використовує наступні технічні індикатори:
- **ret1, ret3, ret12** - прибутковість за 1, 3, 12 періодів
- **vol10** - 10-періодна волатильність
- **ema_diff** - різниця між EMA(12) та EMA(26)
- **rsi** - індекс відносної сили (RSI-14)
- **body_pct** - відсоток тіла свічки
- **vol_spike** - спайк обсягу торгів

### Цільова змінна (Target)

Мульти-класова класифікація:
- **1 (BUY)** - якщо ціна зросте більш ніж на 0.4% протягом 5 свічок
- **-1 (SELL)** - якщо ціна впаде більш ніж на 0.4% протягом 5 свічок
- **0 (HOLD)** - у інших випадках (бічний рух)

### Модель

RandomForest Classifier з наступними параметрами:
- 100 дерев
- Максимальна глибина: 10
- Мінімум 20 зразків для розділення
- Мінімум 10 зразків у листі

### Бектест

Симулює торгівлю з:
- Початковим капіталом: 10,000 USDT
- Комісією: 0.1% на вхід/вихід
- Проковзуванням: 0.05%
- Ризик-фільтром: мінімальна ймовірність 60%, максимальна волатильність 3%

## Важливі застереження

### ⚠️ Попередження про overfit

Поточна модель може бути переоптимізована (overfitted) на історичних даних. Результати бектесту можуть НЕ відповідати результатам на live торгівлі.

### Рекомендації для покращення:

1. **Більше даних** - використовуйте більше історичних даних (6+ місяців)
2. **Cross-validation** - додайте k-fold cross-validation для оцінки стабільності
3. **Walk-forward аналіз** - тестуйте модель на різних часових періодах
4. **Feature selection** - видаліть надлишкові ознаки
5. **Hyperparameter tuning** - оптимізуйте параметри моделі
6. **Ensemble methods** - комбінуйте кілька моделей
7. **Regular retraining** - періодично перетренуйте модель на нових даних

### Що потрібно додати (TODOs):

- [ ] Додати unit тести для всіх модулів
- [ ] Додати логування у файли
- [ ] Реалізувати walk-forward аналіз
- [ ] Додати більше технічних індикаторів
- [ ] Реалізувати position sizing (управління розміром позиції)
- [ ] Додати stop-loss та take-profit логіку
- [ ] Інтеграція з live торгівлею через Binance API
- [ ] Dashboard для моніторингу результатів

## Структура проекту

```
.
├── core/
│   ├── decision_engine.py    # Генерація торгових сигналів
│   ├── feature_builder.py    # Побудова технічних ознак
│   └── risk_filter.py        # Фільтрація ризикованих сигналів
├── training/
│   ├── build_target.py       # Створення цільової змінної
│   ├── train_model.py        # Загальний пайплайн тренування
│   └── train_btc_5m.py       # BTC-специфічне тренування
├── scripts/
│   ├── download_btc_5m.py    # Завантаження даних
│   ├── test_signal.py        # Тестування сигналів
│   ├── run_ai_backtest.py    # Запуск бектесту
│   └── plot_equity.py        # Візуалізація
├── ai_backtest/
│   ├── engine.py             # Движок бектестингу
│   └── metrics.py            # Обчислення метрик
├── models/
│   └── .gitkeep              # Директорія для збереження моделей
└── data/
    └── (генерується при виконанні скриптів)
```

## Метрики та результати

Після запуску бектесту ви побачите:
- **Total trades** - загальна кількість угод
- **Winrate** - відсоток прибуткових угод
- **Average win/loss** - середній прибуток/збиток
- **Expectancy** - математичне очікування прибутку
- **Profit factor** - відношення прибутку до збитку
- **Max drawdown** - максимальна просадка капіталу

## Автор

Додано як частину розвитку binance_ai_trader системи.

## Ліцензія

Слідує ліцензії основного проекту.
